<% include ../partials/header %>

<div class="container">
	<% thisUser.demandPosts.forEach(function(demand){ %>

		<div class="card" style="width: 18rem;">
			<div class="_cardImgBox">
				<img class="card-img-top" src="..." alt="Do you know the way">
			</div>
		  <div class="card-body">
		    <h5 class="card-title"><%= demand.s_unit%> units place</h5>
		    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
		    <a href="#" class="btn btn-primary">Go somewhere</a>
		  </div>
		</div>

	<% }); %>

	<div id="paypal-button"></div>

  <script>
    paypal.Button.render({
      env: 'production', // Or 'sandbox',

      commit: true, // Show a 'Pay Now' button

      client: {
      	sandbox: 'AWNNjtWrzV4ANE_gl6ZBlUgjwZGFmiuFrHn9UWM-A-wcaaUldVSRomIZ0qXtdTfWqDcIhHiV7c4iLpxU',
      	production: 'AZ5dI6bIGJ60oXzj-4n0dVpMzpGHnx1og3xyv9nMRG7qY4RWv1Jw_wgg_FgIfvr46cAUCG7TblOHjem5'
      },

      style: {
        color: 'gold',
        size: 'large',
        shape: 'rect',
        color: 'blue'
      },

      funding: {
        allowed: [ paypal.FUNDING.CREDIT ]
    	},

      payment: function(data, actions) {

      	return actions.payment.create({
            payment: {
                transactions: [
                    {
                        amount: { total: '14.00', currency: 'USD' }
                    }
                ]
            },
            experience: {
                input_fields: {
                    no_shipping: 1
                }
            }
        });
        /* 
         * Set up the payment here 
         */
      },

      onAuthorize: function(data, actions) {

      	// == Get the payment details and do confirmation page

        // return actions.payment.get().then(function(paymentDetails) {

        //     // Show a confirmation using the details from paymentDetails
        //     // Then listen for a click on your confirm button

        //     document.querySelector('#confirm-button')
        //         .addEventListener('click', function() {

        //         // Execute the payment

        //         return actions.payment.execute().then(function() {
        //             // Show a success page to the buyer
        //             window.location.href = '/payment/success';
        //         });
        //     });
        // });

        return actions.payment.execute().then(function(payment) {

            // The payment is complete!
            // You can now show a confirmation message to the customer
        });

        /* 
         * Execute the payment here 
         */
      },

      onCancel: function(data, actions) {
        /* 
         * Buyer cancelled the payment 
         */
      },

      onError: function(err) {
        /* 
         * An error occurred during the transaction 
         */
      }
    }, '#paypal-button');
  </script>

  <br>
  <div id="paypal-button-container"></div>

    <script>
        paypal.Button.render({

            env: 'production', // sandbox | production

            // Show the buyer a 'Pay Now' button in the checkout flow
            commit: true,

            // payment() is called when the button is clicked
            payment: function() {

                // Set up a url on your server to create the payment
                var CREATE_URL = '/demo/checkout/api/paypal/payment/create/';

                // Make a call to your server to set up the payment
                return paypal.request.post(CREATE_URL)
                    .then(function(res) {
                        return res.paymentID;
                    });
            },

            // onAuthorize() is called when the buyer approves the payment
            onAuthorize: function(data, actions) {

                // Set up a url on your server to execute the payment
                var EXECUTE_URL = '/demo/checkout/api/paypal/payment/execute/';

                // Set up the data you need to pass to your server
                var data = {
                    paymentID: data.paymentID,
                    payerID: data.payerID
                };

                // Make a call to your server to execute the payment
                return paypal.request.post(EXECUTE_URL, data)
                    .then(function (res) {
                        window.alert('Payment Complete!');
                    });
            }

        }, '#paypal-button-container');
    </script>
</div>


<% include ../partials/footer %>